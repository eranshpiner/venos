(function(t){function e(e){for(var r,o,s=e[0],l=e[1],c=e[2],d=0,f=[];d<s.length;d++)o=s[d],n[o]&&f.push(n[o][0]),n[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);u&&u(e);while(f.length)f.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],r=!0,s=1;s<i.length;s++){var l=i[s];0!==n[l]&&(r=!1)}r&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var r={},n={app:0},a=[];function o(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=r,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"0552":function(t,e,i){"use strict";var r=i("3b40"),n=i.n(r);n.a},"17b6":function(t,e,i){"use strict";var r=i("bf1e"),n=i.n(r);n.a},"3b40":function(t,e,i){},5490:function(t,e,i){"use strict";var r=i("7e1f"),n=i.n(r);n.a},"567a":function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("a481"),i("cadf"),i("551c"),i("097d");var r=i("2b0e"),n=i("d42c"),a=i("6baf"),o=(i("8385"),i("8917"),i("d06d"),i("0874")),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-app",{staticClass:"color-theme-pink",attrs:{params:t.f7params}},[i("f7-statusbar"),i("f7-view",{attrs:{main:""}})],1)},l=[],c=(i("386d"),i("bc3a")),u=i.n(c),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",[i("f7-navbar",{attrs:{"back-link-force":"","back-link-url":"javascript:window.closeWebView()",title:"פרטי משלוח","back-link":"חזרה"}}),i("f7-block-header",[i("h3",[t._v("פרטי משלוח")])]),i("f7-block",{attrs:{strong:""}},[i("f7-list",{staticClass:"list-nohairline"},[i("here-map",{attrs:{city:t.deliveryInfo.city,street:t.deliveryInfo.street,houseNumber:t.deliveryInfo.houseNumber}}),i("f7-list-item",{attrs:{link:"/checkout/delivery/address/",title:"כתובת",after:t.deliveryAddress}}),i("f7-list-item",{attrs:{link:"#",title:"הוראות לשליח",after:t.deliveryInfo.deliveryRemarks},on:{click:t.deliveryNotesPrompt}}),i("f7-list-item",{staticClass:"nohairline",attrs:{title:"דמי משלוח",after:t.deliveryFee}}),i("f7-list-item",{staticClass:"nohairline",attrs:{title:"טיפ",after:t.tip}}),i("f7-list-item-cell",{staticStyle:{"padding-left":"25px"}},[i("f7-segmented",{attrs:{raised:"",tag:"p"}},[i("f7-button",{attrs:{active:0===t.tipPercentage},on:{click:function(e){t.setTip(0)}}},[t._v("ללא")]),i("f7-button",{attrs:{active:10===t.tipPercentage},on:{click:function(e){t.setTip(10)}}},[t._v("10%")]),i("f7-button",{attrs:{active:12===t.tipPercentage},on:{click:function(e){t.setTip(12)}}},[t._v("12%")]),i("f7-button",{attrs:{active:15===t.tipPercentage},on:{click:function(e){t.setTip(15)}}},[t._v("15%")]),i("f7-button",{attrs:{active:17===t.tipPercentage},on:{click:function(e){t.setTip(17)}}},[t._v("17%")]),i("f7-button",{attrs:{active:-1===[0,10,12,15,17].indexOf(t.$store.orderDetails.tipPercentage)},on:{click:t.tipAmountPrompt}},[t._v("אחר")])],1)],1)],1),i("f7-button",{staticClass:"col",attrs:{big:"",fill:"",raised:""},on:{click:t.next}},[t._v("המשך לתשלום")])],1)],1)},f=[],p=(i("c5f6"),i("ee1d"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticStyle:{width:"100%",height:"120px","z-index":"auto"},style:{display:t.show?"block":"none"},attrs:{id:"map-container"}})])}),h=[],m=(i("0b2f"),i("706a"),i("6154"),i("6dd1"),i("5de0"),window),v=m.H,b=m.document,y={data:function(){return{show:!1,lat:0,lng:0}},mounted:function(){this.platform=new v.service.Platform({app_id:"nyKybJs4fZYfMCd7jfsx",app_code:"E_xE5837hGk33SL8M6hWIg",useCIT:!0,useHTTPS:!0}),this.geocoder=this.platform.getGeocodingService(),this.defaultLayers=this.platform.createDefaultLayers(),this.map=new v.Map(b.getElementById("map-container"),this.defaultLayers.normal.map,{center:new v.geo.Point(this.lat,this.lng),zoom:16}),this.marker=new v.map.Marker({lat:this.lat,lng:this.lng}),this.map.addObject(this.marker),this.lookup()},methods:{updatePosition:function(){var t=this;this.show=!0;var e={lat:this.lat,lng:this.lng};this.marker.setPosition(e),this.map.setCenter(new v.geo.Point(this.lat,this.lng)),this.map.setZoom(15),setTimeout(function(){return t.map.getViewPort().resize()},200)},lookup:function(){var t=this;this.geocoder.geocode({searchText:"".concat(this.street," ").concat(this.houseNumber,", ").concat(this.city)},function(e){if(e.Response.View[0]){var i=e.Response.View[0].Result[0].Location.DisplayPosition;t.lat=i.Latitude,t.lng=i.Longitude,t.updatePosition()}else t.show=!1},function(e){t.show=!1,console.log(e)})}},watch:{city:function(){this.lookup()},street:function(){this.lookup()},houseNumber:function(){this.lookup()}},props:["city","street","houseNumber"]},g=y,w=(i("5490"),i("2877")),k=Object(w["a"])(g,p,h,!1,null,null,null);k.options.__file="Map.vue";var _=k.exports,$={components:{HereMap:_},data:function(){return{subTotal:this.$store.orderDetails.subTotal,deliveryInfo:this.$store.orderDetails.orderOwner.deliveryInfo,tipPercentage:this.$store.orderDetails.tipPercentage||12}},created:function(){this.$store.orderDetails.tipPercentage=this.$store.orderDetails.tipPercentage||12,this.$store.orderDetails.tipAmount=this.$store.orderDetails.tipAmount||Math.floor(.12*this.subTotal)},computed:{tip:function(){return"₪".concat(this.tipPercentage>0?Math.floor(this.subTotal*(this.tipPercentage/100)):0)},deliveryFee:function(){return"₪".concat(this.$store.orderDetails.deliveryFee)},deliveryAddress:function(){return"".concat(this.deliveryInfo.street," ").concat(this.deliveryInfo.houseNumber,", ").concat(this.deliveryInfo.city)}},methods:{setTip:function(t){this.$store.deliveryDetails.tipPercentage=t,this.$store.deliveryDetails.tipAmount=this.tipPercentage>0?Math.floor(this.subTotal*(t/100)):0,this.tipPercentage=t},deliveryNotesPrompt:function(){var t=this;this.$f7.dialog.prompt("הכנס הערות לשלח","הערות לשליח",function(e){t.deliveryInfo.deliveryRemarks=e})},tipAmountPrompt:function(){var t=this;this.$f7.dialog.prompt("הכנס אחוז טיפ","טיפ",function(e){t.setTip(!Number.isNaN(e)&&e>0?e:0)})},next:function(){this.$f7router.navigate("/checkout/payment")}}},C=$,D=(i("0552"),Object(w["a"])(C,d,f,!1,null,null,null));D.options.__file="Delivery.vue";var x=D.exports,P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",[i("f7-navbar",{attrs:{title:"עדכון כתובת","back-link":"חזרה"}}),i("f7-block-header",[i("h3",[t._v("עדכון כתובת")])]),i("f7-block",{attrs:{strong:""}},[i("f7-list",{attrs:{"inline-labels":"","no-hairlines-md":""}},[i("f7-list-item",[i("f7-label",[t._v("עיר")]),i("f7-input",{attrs:{type:"text",placeholder:"",value:t.city},on:{input:function(e){t.city=e.target.value}}})],1),i("f7-list-item",[i("f7-label",[t._v("רחוב")]),i("f7-input",{attrs:{type:"text",placeholder:"",value:t.street},on:{input:function(e){t.street=e.target.value}}})],1),i("f7-list-item",[i("f7-label",[t._v("מס׳/כניסה")]),i("f7-input",{attrs:{type:"text",placeholder:"",value:t.houseNumber},on:{input:function(e){t.houseNumber=e.target.value}}})],1)],1),i("f7-button",{staticClass:"col",attrs:{big:"",fill:"",raised:""},on:{click:t.save}},[t._v("המשך")])],1)],1)},T=[],O={data:function(){return{city:this.$store.orderDetails.orderOwner.deliveryInfo.city,street:this.$store.orderDetails.orderOwner.deliveryInfo.street,houseNumber:this.$store.orderDetails.orderOwner.deliveryInfo.houseNumber}},methods:{save:function(){this.$store.orderDetails.orderOwner.deliveryInfo.city=this.city,this.$store.orderDetails.orderOwner.deliveryInfo.street=this.street,this.$store.orderDetails.orderOwner.deliveryInfo.houseNumber=this.houseNumber,this.$f7router.back()}}},I=O,N=(i("17b6"),Object(w["a"])(I,P,T,!1,null,null,null));N.options.__file="Address.vue";var j=N.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",[i("f7-navbar",{attrs:{title:"פרטי תשלום","back-link":"חזרה"}}),i("f7-block-header",[i("h3",[t._v("פרטי תשלום")])]),i("f7-block",{attrs:{strong:""}},[i("f7-list",{ref:"form",attrs:{form:"","inline-labels":"","no-hairlines-md":""},on:{submit:t.submit}},[i("f7-list-item",[i("f7-label",[t._v("אימייל")]),i("f7-input",{attrs:{validate:"",required:"","error-message":"נא להכניס כתובת אימייל תקינה",type:"email",pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$",placeholder:"לצורך משלוח אישור הזמנה",value:t.paymentDetails.email},on:{input:function(e){t.paymentDetails.email=e.target.value}}})],1),i("f7-list-item",[i("f7-label",[t._v("בעל הכרטיס")]),i("f7-input",{attrs:{validate:"",required:"","error-message":"נא להכניס שם",type:"text",placeholder:"שם מלא",value:t.paymentDetails.creditCardHolderId},on:{input:function(e){t.paymentDetails.creditCardHolderId=e.target.value}}})],1),i("f7-list-item",[i("f7-label",[t._v("מספר כרטיס")]),i("f7-input",{staticStyle:{direction:"ltr"}},[i("cleave",{attrs:{minlength:"18",type:"tel",options:t.ccOptions},model:{value:t.paymentDetails.creditCardNumber,callback:function(e){t.$set(t.paymentDetails,"creditCardNumber",e)},expression:"paymentDetails.creditCardNumber"}}),i("div",{staticClass:"cc-info",class:{valid:t.isCreditCardValid},attrs:{slot:"info"},slot:"info"},[i("icon",{class:{active:"amex"===t.ccType},attrs:{name:"brands/cc-amex",scale:"2"}}),i("icon",{class:{active:"mastercard"===t.ccType},attrs:{name:"brands/cc-mastercard",scale:"2"}}),i("icon",{class:{active:"visa"===t.ccType},attrs:{name:"brands/cc-visa",scale:"2"}})],1)],1)],1),i("f7-list-item",[i("f7-label",[t._v("תוקף")]),i("f7-input",{attrs:{"error-message":"נא להכניס שם"}},[i("cleave",{attrs:{validate:"",required:"",pattern:"\\d\\d/\\d\\d",minlength:"5","data-error-message":"נא להכניס תוקף כרטיס",options:t.ccExpOptions},model:{value:t.paymentDetails.creditCardExp,callback:function(e){t.$set(t.paymentDetails,"creditCardExp",e)},expression:"paymentDetails.creditCardExp"}})],1)],1),i("f7-list-item",[i("f7-label",[t._v("קוד CVV")]),i("f7-input",{attrs:{validate:"",required:"","error-message":"נא להכניס קוד בעל 3/4 ספרות",type:"tel",pattern:"\\d*",maxlength:"4",minlength:"3",placeholder:"•••",value:t.paymentDetails.creditCardCvv},on:{input:function(e){t.paymentDetails.creditCardCvv=e.target.value}}})],1),i("input",{staticClass:"button button-fill button-big button-raised",attrs:{type:"submit"},domProps:{value:"שלם ₪"+t.total}})],1)],1)],1)},M=[],S=(i("6762"),i("2fdb"),i("2083")),A=i.n(S),V={components:{Cleave:A.a},data:function(){return{paymentDetails:this.$store.paymentDetails,ccType:"unknown",ccOptions:{creditCard:!0,delimiter:"-",onCreditCardTypeChanged:this.onCreditCardTypeChanged},ccExpOptions:{date:!0,datePattern:["m","y"]}}},mounted:function(){var t=this;this.$nextTick(function(){t.$refs.form.$el.addEventListener("submit",t.submit)})},computed:{total:function(){return this.$store.orderDetails.subTotal+this.$store.orderDetails.tipAmount+this.$store.orderDetails.deliveryFee},isCreditCardValid:function(){return!(!["visa","mastercard"].includes(this.ccType)||16!==this.paymentDetails.creditCardNumber.length)||!(!["amex"].includes(this.ccType)||15!==this.paymentDetails.creditCardNumber.length)}},methods:{onCreditCardTypeChanged:function(t){this.ccType=t},isInvalid:function(){return!(this.isCreditCardValid&&this.$refs.form&&this.$refs.form.$el.checkValidity())},submit:function(t){var e=this;t.preventDefault(),this.isInvalid()?this.$f7.dialog.alert("אנא השלם את כל השדות"):(this.$f7.dialog.preloader("שולח הזמנה..."),u.a.post("/api/order/".concat(this.$store.orderId,"/pay"),{paymentDetails:this.$store.paymentDetails,deliveryDetails:this.$store.deliveryDetails}).then(function(t){e.$store.transaction=t.data.transaction,e.$f7router.navigate("/checkout/confirmation"),e.$f7.dialog.close()}).catch(function(t){console.log("Error submitting payment",t),e.$f7.dialog.close(),400===t.response.status?e.$f7.dialog.alert("אחד הפרטים שהוזנו שגוי"):e.$f7.dialog.alert("שגיאה! אנא נסה שוב")}))}}},L=V,q=(i("b781"),Object(w["a"])(L,E,M,!1,null,null,null));q.options.__file="Payment.vue";var z=q.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"text-align-center"},[i("f7-block-header",{staticClass:"text-align-center"},[i("h1",[t._v("הזמנתך נקלטה!")])]),i("icon",{staticStyle:{color:"#5fe100"},attrs:{name:"check-circle",scale:"10"}}),i("p",[t._v("מספר ההזמנה שלך הוא: "+t._s(t.transaction.id))]),i("f7-button",{attrs:{big:"",fill:"",raised:""},on:{click:t.close}},[t._v("חזרה לשיחה")])],1)},F=[],R={data:function(){return{transaction:this.$store.transaction}},methods:{close:function(){window.closeWebView()}}},W=R,H=Object(w["a"])(W,B,F,!1,null,null,null);H.options.__file="Confirmation.vue";var J=H.exports,G={mounted:function(){var t=this,e=new URLSearchParams(window.location.search);this.$f7ready(function(i){i.dialog.preloader("טוען הזמנה..."),t.$store.jwt=e.get("jwt"),u.a.post("/api/order",{jwt:t.$store.jwt}).then(function(e){var r=e.data,n=r.orderId,a=r.order;t.$store.orderDetails=a,t.$store.orderId=n,i.dialog.close(),i.router.navigate("/checkout/delivery/",{animate:!1})}).catch(function(t){console.log(t),i.dialog.close(),i.dialog.alert("לא הצלחנו לעבד את ההזמנה שלך","אוי לא!",function(){window.closeWebView()})})})},data:function(){return{f7params:{id:"com.tagoose.web",name:"ביצוע הזמנה",theme:"auto",routes:[{path:"/checkout/",component:x},{path:"/checkout/delivery/",component:x,routes:[{path:"address/",component:j}]},{path:"/checkout/payment",component:z},{path:"/checkout/confirmation",component:J}]}}}},U=G,Z=Object(w["a"])(U,s,l,!1,null,null,null);Z.options.__file="App.vue";var K=Z.exports,Y=i("9483");Object(Y["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},cached:function(){console.log("Content has been cached for offline use.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});var Q=new r["a"]({data:{orderDetails:{},paymentDetails:{},deliveryDetails:{}}});Q.install=function(){Object.defineProperty(r["a"].prototype,"$store",{get:function(){return Q}})};var X=Q;r["a"].use(X),r["a"].component("icon",o["a"]),n["a"].use(a["a"]),r["a"].config.productionTip=!1,new r["a"]({store:X,render:function(t){return t(K)}}).$mount("#app"),function(t,e,i){var r=t.getElementsByTagName(e)[0];if(!t.getElementById(i)){var n=t.createElement(e);n.id=i,n.src="//connect.facebook.net/en_US/messenger.Extensions.js",r.parentNode.insertBefore(n,r)}}(document,"script","Messenger"),window.closeWebView=function(){var t="נא לסגור את החלון כדי לחזור לשיחה";try{window.MessengerExtensions.requestCloseBrowser(function(){},function(){window.location.replace("https://www.messenger.com/closeWindow/?display_text=".concat(t,"&display_image="))})}catch(e){window.alert(t)}}},"7e1f":function(t,e,i){},b781:function(t,e,i){"use strict";var r=i("567a"),n=i.n(r);n.a},bf1e:function(t,e,i){}});
//# sourceMappingURL=app.6e1b148d.js.map